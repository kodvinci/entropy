# README

### Payload Format
The payload is in the form of a 32-bit unsigned int. Thic can be decoded into a decimal number using the decoder function. The function is found in the console in the decoder tab under the Payload Format tab. The object returned by the decoder function is what is uploaded to the Data Storage Integration.

### Data Storage Integration
To make the data generated by the device accessible over a RESTful API, a Data Storage integration needs to be added to the application. This can be done using the steps outlined [in this tutorial](https://www.youtube.com/watch?v=kVf8GmCbOuE). Once the Data Storage integration has been added, the data generated by the device is stored on a swagger database hosted by The Things Network under a domain name similar to the app ID. This database stores data for 7 days. To access this data over the API, the integration has to be authorized by adding the access key of the application (found in the Overview tap) so that http requests to it can authenticate using it.

### Data Access Over a RESTful API
To query the data contained in the application, send a request to the following url:
```
https://your-app-id.data.thethingsnetwork.org/api/v2/query?
```
An example of a curl request to get the data from the last hour is below:
```
curl -X GET --header 'Accept: application/json' --header 'Authorization: key your-app-access-key-here' 'https://your-app-id.data.thethingsnetwork.org/api/v2/query?last=1h'
```
The return value is a JSON array. Each JSON object contains amongst its keys a device_id representing which device generated that particular data point. From here, the data can presented to users in different manners as required.

### Run The Example App Locally
The example app is a Ruby on Rails application that simply requests data (devices registered to the application and device data for a given period - default is last hour) from the data storage endpoint of the application on TTN. It sends along with each request the access key of the application for authentication purposes. The relevant code for this is found in the [device.rb](https://github.com/kodvinci/entropy/blob/master/app/models/device.rb).
To run the application on your system, install the correct version of Ruby contained in the Gemfile (2.3.1) using [RVM](https://rvm.io/). Open a terminal window and clone the repository, navigate into its cloned folder and run the following commands:
```
- bundle install
- rake db:create
- rake db:migrate
- rails s
```
Point your browser to ```localhost:3000```. Listed here would be the devices under the application (one at the moment). Click on the device ID and you should be able to see a graph of the data for the device fetched from TTN. 

### Hosted Example
An example of this application is hosted on [Heroku](https://kaiote-entropy.herokuapp.com/) (Initial request might be slow if the application has not be accessed in awhile - free dyno goes to sleep).
